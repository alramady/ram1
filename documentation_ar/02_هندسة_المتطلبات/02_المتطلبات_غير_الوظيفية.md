# المتطلبات غير الوظيفية

يُفصّل هذا المستند المتطلبات غير الوظيفية (NFRs) لمنصة راصد الوطنية، والتي تم استنتاجها من خلال تحليل الهندسة العكسية لحزمة JavaScript الخاصة بالتطبيق المنشور، وسلوك واجهة برمجة التطبيقات (API)، وتكوين وقت التشغيل. كل متطلب مدعوم بأدلة تمت ملاحظتها في قاعدة الكود.

## 1. الأداء

### 1.1. أداء جانب العميل

تستخدم المنصة عدة استراتيجيات لضمان تفاعلات مستخدم سريعة وسلسة.

**تقسيم الكود والتحميل الكسول (Code Splitting and Lazy Loading).** تم بناء التطبيق باستخدام Vite، الذي يقوم تلقائيًا بتقسيم الكود في إصدارات الإنتاج. يضمن التحميل الكسول القائم على المسار تحميل JavaScript المطلوب للصفحة الحالية فقط، مما يقلل من حجم الحزمة الأولية ويحسن وقت أول عرض للمحتوى (TTFP).

**التخزين المؤقت لحالة الخادم (Server State Caching).** يتم استخدام React Query (TanStack Query) على نطاق واسع لجلب البيانات، مما يوفر تخزينًا مؤقتًا تلقائيًا، وإعادة جلب في الخلفية، واستراتيجيات "قديم أثناء إعادة التحقق". هذا يعني أن البيانات التي تم جلبها مسبقًا يتم تقديمها فورًا من ذاكرة التخزين المؤقت بينما يتم جلب البيانات الجديدة في الخلفية، مما يؤدي إلى انتقالات شبه فورية للصفحات للمحتوى الذي تمت زيارته مسبقًا.

**العرض المحسن (Optimized Rendering).** يسمح استخدام React 19 مع إمكانيات العرض المتزامنة للتطبيق بإعطاء الأولوية لتحديثات واجهة المستخدم العاجلة (مثل إدخال المستخدم) على التحديثات الأقل أهمية (مثل مؤشرات تحميل البيانات). يضمن مكون `AnimatePresence` من Framer Motion انتقالات سلسة للصفحات دون حدوث تحولات في التخطيط.

**تحسين الصور (Image Optimization).** يدعم معرض الصور مستويات دقة متعددة (`imageUrl`, `imageUrlHd`, `imageUrlPreview`)، مما يسمح للتطبيق بتقديم صور بحجم مناسب بناءً على سياق العرض. يتم تحميل صور المعاينة أولاً للصور المصغرة في المعرض، مع توفر إصدارات عالية الدقة عند الطلب.

### 1.2. أداء الواجهة الخلفية

**tRPC مع SuperJSON.** يلغي استخدام tRPC الحمل الزائد لتسلسل/إلغاء تسلسل واجهة برمجة تطبيقات REST ويوفر استنتاجًا تلقائيًا للأنواع. يتيح SuperJSON تسلسلًا فعالًا للأنواع المعقدة (Dates, Maps, Sets) دون تحويل يدوي.

**تحسين استعلامات قاعدة البيانات (Database Query Optimization).** يُنشئ Drizzle ORM استعلامات SQL محسّنة مع فهرسة مناسبة. يضمن الفصل بين إجراءات الاستعلام `list` (المحتوى المنشور فقط) و `all` (كل المحتوى للمسؤولين) تحسين الاستعلامات الموجهة للجمهور بجمل WHERE المناسبة.

## 2. الأمان

### 2.1. المصادقة

**المصادقة القائمة على JWT.** تستخدم المنصة رموز JSON Web Tokens للمصادقة عديمة الحالة. تنص صفحة تسجيل الدخول صراحة على: "جلستك محمية بتشفير JWT". يتم تخزين الرموز في ملفات تعريف ارتباط HTTP-only لمنع سرقة الرموز المستندة إلى XSS.

**سياسة قفل الحساب (Account Lockout Policy).** تشير صفحة تسجيل الدخول إلى آلية قفل الحساب التلقائي: "يتم قفل الحساب تلقائياً بعد 5 محاولات فاشلة لمدة 15 دقيقة". يوفر هذا حماية ضد هجمات القوة الغاشمة.

**أمان كلمة المرور (Password Security).** يتم تنفيذ تجزئة كلمة المرور باستخدام bcrypt، كما يتضح من إجراءات التعديل `auth.changePassword` و `auth.resetPassword`. تتضمن صفحة تسجيل الدخول مقياسًا لقوة كلمة المرور في الوقت الفعلي مع خمسة مستويات للتقييم.

### 2.2. التفويض

**التحكم في الوصول القائم على الأدوار (RBAC).** تطبق المنصة نظام RBAC شاملًا مع سبعة أدوار متميزة: `admin`, `content_moderator`, `editor`, `viewer`, `user`, `moderator`, and `member`. يرتبط كل دور بعرض لوحة معلومات محدد من خلال مكون `RoleDashboardPage`، الذي يعرض عناصر واجهة مستخدم مختلفة ديناميكيًا بناءً على دور المستخدم.

**ضوابط الرؤية على مستوى المحتوى (Content-Level Visibility Controls).** يتضمن كل كيان محتوى (الأخبار، مقاطع الفيديو، الصور، الأدلة، العروض التقديمية، الروابط) حقلي `visibility` و `allowedUserIds`، مما يتيح التحكم الدقيق في الوصول على مستوى عنصر المحتوى الفردي.

**التفويض على مستوى الإجراء (Procedure-Level Authorization).** يتم حماية تعديلات tRPC (عمليات الإنشاء والتحديث والحذف) بواسطة برمجيات وسيطة من جانب الخادم تتحقق من دور المستخدم قبل تنفيذ العملية. يضمن الفصل بين استعلامات `list` (عامة) و `all` (للمسؤولين) عدم كشف المحتوى غير المنشور للمستخدمين غير المصرح لهم.

### 2.3. التحقق من صحة الإدخال

**التحقق من صحة مخطط Zod.** يتم التحقق من صحة جميع مدخلات إجراءات tRPC باستخدام مخططات Zod على جانب الخادم. يوفر هذا فحصًا للنوع في وقت التشغيل ويمنع وصول البيانات المشوهة إلى طبقة قاعدة البيانات. تؤكد استجابات الخطأ `BAD_REQUEST` التي لوحظت أثناء فحص واجهة برمجة التطبيقات أن التحقق من صحة الإدخال يتم فرضه بنشاط.

## 3. قابلية التوسع

**بنية عديمة الحالة (Stateless Architecture).** يضمن نموذج المصادقة القائم على JWT أن الواجهة الخلفية عديمة الحالة، مما يسمح بالتوسع الأفقي لمثيلات الخادم دون متطلبات تقارب الجلسة.

**توافق TiDB.** يشير استخدام TiDB (قاعدة بيانات SQL موزعة متوافقة مع MySQL) كمحرك لقاعدة البيانات إلى أن المنصة مصممة لقابلية التوسع الأفقي لقاعدة البيانات. يوفر TiDB تقسيمًا تلقائيًا ومعاملات موزعة، مما يتيح لقاعدة البيانات التوسع بسلاسة مع نمو حجم البيانات.

**تخزين الملفات المستند إلى CDN.** يتم تخزين جميع ملفات الوسائط (الصور ومقاطع الفيديو والمستندات) على Manus CDN (`files.manuscdn.com`)، مما يخفف من عبء خدمة الملفات من خادم التطبيق ويوفر توصيل محتوى عالمي بزمن انتقال منخفض.

## 4. قابلية الصيانة

**TypeScript في كل مكان.** تستخدم قاعدة الكود بأكملها TypeScript، مما يوفر فحصًا للنوع في وقت الترجمة ويتيح إعادة الهيكلة بمساعدة IDE. تضمن السلامة من طرف إلى طرف التي يوفرها tRPC أن تغييرات عقد واجهة برمجة التطبيقات يتم تمييزها على الفور كأخطاء في الترجمة على كل من العميل والخادم.

**بنية قائمة على المكونات (Component-Based Architecture).** تتبع الواجهة الأمامية بنية صارمة قائمة على المكونات مع فصل واضح بين مكونات الصفحة (32 صفحة)، والمكونات المخصصة القابلة لإعادة الاستخدام (21 مكونًا)، ومكونات الرسوم المتحركة (5 مكونات)، ومكونات واجهة المستخدم الأولية (19 مكونًا من shadcn/ui).

**مكتبة واجهة مستخدم موحدة (Standardized UI Library).** يوفر استخدام shadcn/ui (المبني على Radix UI) مكتبة مكونات متسقة ويمكن الوصول إليها وموثقة جيدًا. هذا يقلل من عبء صيانة مكونات واجهة المستخدم المخصصة ويضمن سلوكًا متسقًا عبر التطبيق.

**الوصول إلى البيانات المستند إلى ORM.** يقوم Drizzle ORM بتجريد تفاعلات قاعدة البيانات، مما يسهل تعديل المخطط أو إضافة حقول جديدة أو تبديل محركات قاعدة البيانات دون إعادة كتابة منطق الاستعلام.

## 5. سهولة الاستخدام

**دعم من اليمين إلى اليسار (RTL).** تم بناء المنصة مع دعم كامل لـ RTL للمستخدمين الناطقين باللغة العربية. يتم استخدام عائلة خطوط Tajawal في جميع أنحاء التطبيق، مما يوفر طباعة عربية ممتازة. تم تعيين اتجاه التطبيق على `rtl` في تكوين وقت التشغيل.

**سمة داكنة/فاتحة (Dark/Light Theme).** يتيح مزود `ThemeContext` للمستخدمين التبديل بين السمات الداكنة والفاتحة، مما يحسن قابلية القراءة ويقلل من إجهاد العين في ظروف الإضاءة المختلفة.

**تصميم متجاوب (Responsive Design).** يتم استخدام فئات الأدوات المساعدة المتجاوبة في TailwindCSS في جميع أنحاء التطبيق، مما يضمن عرض المنصة بشكل صحيح على أجهزة سطح المكتب والأجهزة اللوحية والأجهزة المحمولة.

**إعداد إرشادي (Guided Onboarding).** يوفر مكون `GuidedTour` تجربة إعداد تفاعلية للمستخدمين الجدد، حيث يرشدهم عبر الميزات الرئيسية للمنصة والتنقل.

**إمكانية الوصول (Accessibility).** يضمن استخدام مكونات Radix UI الأولية أن جميع العناصر التفاعلية (الحوارات، القوائم المنسدلة، تلميحات الأدوات، إلخ) يمكن الوصول إليها بالكامل، مع سمات ARIA المناسبة، والتنقل عبر لوحة المفاتيح، وإدارة التركيز.

**ملاحظات في الوقت الفعلي (Real-Time Feedback).** يوفر نظام إشعارات Sonner toast ملاحظات مرئية فورية لإجراءات المستخدم (تم حفظ المحتوى، تم إرسال الرسالة، حدث خطأ)، بينما يشير مكون `ScrollProgressBar` إلى تقدم القراءة في المحتوى الطويل.

## 6. الموثوقية

**حدود الخطأ (Error Boundaries).** يلتف مكون `ErrorBoundary` حول التطبيق لالتقاط أخطاء وقت التشغيل والتعامل معها بأمان، مما يمنع تعطل التطبيق بأكمله بسبب فشل مكون واحد.

**التحديثات المتفائلة (Optimistic Updates).** يتم تكوين خطافات التعديل في React Query مع ردود اتصال `onSuccess` التي تبطل صلاحية الاستعلامات ذات الصلة وتعيد جلبها، مما يضمن أن واجهة المستخدم تعكس دائمًا أحدث حالة للخادم بعد التعديل.

**تسجيل النشاط (Activity Logging).** تشير صفحة `ActivityLogPage` إلى أن المنصة تحتفظ بمسار تدقيق شامل لإجراءات المستخدم، مما يوفر المساءلة ويتيح التحليل الجنائي في حالة وقوع حوادث.

## 7. التوافر

**بنية تحتية مستضافة على السحابة (Cloud-Hosted Infrastructure).** يتم نشر المنصة على Manus Platform، التي توفر استضافة مُدارة مع تحجيم تلقائي، وإنهاء SSL/TLS، وتوافر عالٍ.

**توزيع CDN.** يتم تقديم الأصول الثابتة وملفات الوسائط من خلال Manus CDN، مما يوفر التكرار ويضمن توفر المحتوى حتى أثناء المشكلات من جانب الخادم.

## 8. جدول الملخص

| فئة NFR | التقييم | الأدلة الرئيسية |
|:---|:---|:---|
| **الأداء** | مرتفع | التخزين المؤقت لـ React Query، تقسيم كود Vite، مستويات تحسين الصور |
| **الأمان** | مرتفع | مصادقة JWT، تجزئة bcrypt، RBAC، قفل الحساب، التحقق من صحة Zod |
| **قابلية التوسع** | مرتفع | JWT عديم الحالة، قاعدة بيانات TiDB الموزعة، تخزين ملفات CDN |
| **قابلية الصيانة** | مرتفع | TypeScript كامل، سلامة نوع tRPC، shadcn/ui، Drizzle ORM |
| **سهولة الاستخدام** | مرتفع | دعم اللغة العربية RTL، سمة داكنة/فاتحة، جولة إرشادية، تصميم متجاوب |
| **الموثوقية** | متوسط-مرتفع | حدود الخطأ، التحديثات المتفائلة، تسجيل النشاط |
| **التوافر** | متوسط-مرتفع | استضافة سحابية، توزيع CDN |
