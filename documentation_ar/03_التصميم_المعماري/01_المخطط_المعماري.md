# التصميم المعماري

يقدم هذا القسم نظرة عامة مفصلة على التصميم المعماري لمنصة راصد الوطنية، ويغطي تقنيات الواجهة الأمامية والخلفية، ونماذج البيانات، وهيكل واجهة برمجة التطبيقات (API).

## 1. الحزمة التقنية

تم بناء المنصة على حزمة تقنية حديثة وقوية، مما يضمن قابلية التوسع والأداء وسهولة الصيانة.

### 1.1. الواجهة الأمامية (Frontend)

الواجهة الأمامية هي تطبيق صفحة واحدة (SPA) تم تطويره باستخدام التقنيات التالية:

| الفئة | التقنية |
| --- | --- |
| **إطار العمل** | React 19 |
| **اللغة** | TypeScript |
| **أداة البناء** | Vite |
| **التصميم** | TailwindCSS |
| **مكتبة واجهة المستخدم** | Radix UI (عبر shadcn/ui) |
| **إدارة الحالة** | React Query (TanStack Query) |
| **التوجيه** | Wouter |
| **الرسوم المتحركة** | Framer Motion |
| **محرر النصوص المنسقة** | Tiptap |
| **الرسوم البيانية** | Recharts |
| **الإشعارات** | Sonner |
| **الخط** | Tajawal (للنص العربي) |
| **الأيقونات** | Lucide React |

### 1.2. الواجهة الخلفية (Backend)

يتم تشغيل الواجهة الخلفية بواسطة بيئة تشغيل Node.js وتستفيد من التقنيات التالية:

| الفئة | التقنية |
| --- | --- |
| **بيئة التشغيل** | Node.js |
| **إطار عمل API** | tRPC |
| **قاعدة البيانات** | MySQL/TiDB (عبر Drizzle ORM) |
| **المصادقة** | JWT (JSON Web Tokens) |
| **تخزين الملفات** | Manus CDN (manuscdn.com) |
| **الاستضافة** | Manus Platform |

## 2. نموذج البيانات

يتم تنظيم بيانات التطبيق في عدة جداول، يمثل كل منها كيانًا أساسيًا داخل النظام. يوضح الجدول التالي مخطط قاعدة البيانات:

| الجدول | الوصف |
| --- | --- |
| `news` | يخزن المقالات الإخبارية والبيانات الوصفية ذات الصلة. |
| `videos` | يدير محتوى الفيديو والتفاصيل المرتبطة به. |
| `images` | يحتوي على معلومات معرض الصور. |
| `guides` | يخزن الأدلة والمستندات القابلة للتنزيل. |
| `presentations` | يدير ملفات العروض التقديمية والبيانات الوصفية. |
| `links` | يخزن مجموعة من الروابط الخارجية والداخلية. |
| `guestbook` | يجمع الإدخالات من سجل زوار الموقع. |
| `tags` | يدير العلامات لتصنيف المحتوى. |
| `users` | يخزن معلومات حساب المستخدم والأدوار. |
| `settings` | يحتوي على إعدادات التكوين على مستوى التطبيق. |

## 3. نقاط نهاية API

تستخدم المنصة tRPC للاتصال الآمن بالأنواع (type-safe) بين الواجهة الأمامية والخلفية. يتم تنظيم واجهة برمجة التطبيقات في مساحات أسماء منطقية، لكل منها مجموعة من الاستعلامات (لاسترداد البيانات) والتعديلات (لتعديل البيانات).

### 3.1. المصادقة (`auth`)

- **الاستعلامات**: `me`
- **التعديلات**: `localLogin`, `logout`, `changePassword`, `requestPasswordReset`, `resetPassword`, `updateProfile`, `uploadAvatar`

### 3.2. إدارة المحتوى

- **الأخبار (`news`)**: `list`, `all`, `latest`, `getById`, `create`, `update`, `delete`
- **مقاطع الفيديو (`videos`)**: `list`, `all`, `create`, `update`, `delete`
- **الصور (`images`)**: `list`, `all`, `create`, `update`, `delete`
- **الأدلة (`guides`)**: `list`, `all`, `create`, `update`, `delete`
- **العروض التقديمية (`presentations`)**: `list`, `all`, `getById`, `create`, `update`, `delete`
- **الروابط (`links`)**: `list`, `all`, `create`, `update`, `delete`

### 3.3. تفاعل المستخدم

- **سجل الزوار (`guestbook`)**: `list`, `all`, `create`, `approve`, `delete`
- **العلامات (`tags`)**: `list`, `getContentByTag`, `create`, `update`, `delete`
- **الإشارات المرجعية (`bookmarks`)**: `myBookmarks`, `isBookmarked`, `toggle`
- **الإشعارات (`notifications`)**: `list`, `unreadCount`, `markRead`, `markAllRead`
- **الرسائل (`messages`)**: `inbox`, `sent`, `unreadCount`, `users`, `send`, `broadcast`, `delete`, `markRead`, `markUnread`

### 3.4. الإدارة والتحليلات

- **المستخدمون (`users`)**: `list`, `update`
- **التحليلات (`analytics`)**: `overview`, `activityByDay`, `bookmarksByType`, `commentsByMonth`, `contentByMonth`, `likesByType`, `recentActivity`, `topLiked`, `userRegistrations`, `generateReport`
- **لوحة التحكم (`dashboard`)**: `stats`
- **الموافقة (`approval`)**: `mySubmissions`, `pendingNews`, `pendingVideos`, `submitNews`, `submitVideo`, `reviewNews`, `reviewVideo`
- **الإعدادات (`settings`)**: `getAll`, `set`
- **SMTP (`smtp`)**: `getConfig`, `saveConfig`, `testEmail`
- **الجدولة (`scheduling`)**: `allNewsWithStatus`, `allVideosWithStatus`, `scheduledNews`, `scheduledVideos`, `updateNewsStatus`, `updateVideoStatus`, `publishNow`
- **ترتيب المحتوى (`contentOrder`)**: `getNews`, `getVideos`, `updateNewsOrder`, `updateVideosOrder`
- **التقرير الأسبوعي (`weeklyReport`)**: `getData`, `getSettings`, `saveSettings`, `sendNow`

### 3.5. البحث

- **البحث (`search`)**: `query`

## 4. التوجيه من جانب العميل

تستخدم الواجهة الأمامية `wouter` للتوجيه من جانب العميل. يوضح الجدول التالي كيفية تعيين مسارات URL إلى صفحاتها أو ميزاتها المقابلة:

| المسار | الصفحة/الميزة |
| --- | --- |
| `/` | الرئيسية |
| `/news` | قائمة الأخبار |
| `/news/:id` | تفاصيل الخبر |
| `/videos` | قائمة مقاطع الفيديو |
| `/gallery` | معرض الصور |
| `/links` | قائمة الروابط |
| `/guides` | قائمة الأدلة |
| `/presentations` | قائمة العروض التقديمية |
| `/presentations/:id` | عارض العروض التقديمية |
| `/guestbook` | سجل الزوار |
| `/about` | حول المنصة |
| `/help-center` | مركز المساعدة |
| `/login` | صفحة تسجيل الدخول |
| `/reset-password` | إعادة تعيين كلمة المرور |
| `/member` | خدمات الأعضاء |
| `/members` | إدارة الأعضاء (مسؤول) |
| `/profile` | الملف الشخصي للمستخدم |
| `/dashboard` | لوحة تحكم المسؤول |
| `/my-dashboard` | لوحة التحكم الشخصية |
| `/role-dashboard` | لوحة التحكم القائمة على الدور |
| `/analytics` | التحليلات (مسؤول) |
| `/approval` | الموافقة على المحتوى (مسؤول) |
| `/bookmarks` | الإشارات المرجعية للمستخدم |
| `/content-order` | ترتيب المحتوى (مسؤول) |
| `/messages` | الرسائل/صندوق الوارد |
| `/roles` | إدارة الأدوار (مسؤول) |
| `/scheduling` | جدولة المحتوى (مسؤول) |
| `/search` | نتائج البحث |
| `/smtp-settings` | إعدادات SMTP (مسؤول) |
| `/tags` | إدارة العلامات (مسؤول) |
| `/weekly-reports` | التقارير الأسبوعية (مسؤول) |
| `/activity-log` | سجل النشاط (مسؤول) |
| `/404` | صفحة غير موجودة |
