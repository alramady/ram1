# دليل المساهمين

يقدم هذا الدليل إرشادات للمطورين الذين يرغبون في المساهمة في منصة راصد الوطنية. ويغطي إعداد بيئة التطوير ومعايير الترميز وعملية تقديم التغييرات.

## 1. إعداد بيئة التطوير

### 1.1. المتطلبات الأساسية

تأكد من تثبيت البرامج التالية على جهاز التطوير الخاص بك:

- **Node.js** 22.x أو أحدث (تنزيل من [nodejs.org](https://nodejs.org/))
- **npm** (مضمن مع Node.js) أو **pnpm** (موصى به للتثبيتات الأسرع)
- **MySQL** 8.x أو **TiDB** 7.x (لقاعدة البيانات المحلية)
- **Git** (للتحكم في الإصدار)
- **VS Code** (محرر الكود الموصى به مع الامتدادات التالية):
  - ESLint
  - Prettier
  - Tailwind CSS IntelliSense
  - TypeScript and JavaScript Language Features

### 1.2. الإعداد الأولي

```bash
# 1. استنساخ المستودع
git clone <repository-url>
cd rasid-platform

# 2. تثبيت الاعتماديات
npm install

# 3. نسخ قالب البيئة
cp .env.example .env

# 4. تكوين ملف .env المحلي الخاص بك (راجع دليل البناء والنشر)

# 5. تهيئة قاعدة البيانات
npx drizzle-kit push

# 6. بدء خادم التطوير
npm run dev
```

سيكون التطبيق متاحًا على `http://localhost:5000` مع تمكين استبدال الوحدة النمطية السريع لكل من تغييرات الواجهة الأمامية والخلفية.

## 2. هيكل المشروع

يعد فهم هيكل المشروع أمرًا ضروريًا للمساهمة الفعالة. تتبع قاعدة الكود هيكل مستودع أحادي مع فصل واضح بين كود العميل والخادم.

```
project-root/
├── client/                    # تطبيق الواجهة الأمامية
│   └── src/
│       ├── App.tsx            # التطبيق الرئيسي مع تعريفات التوجيه
│       ├── main.tsx           # نقطة دخول React
│       ├── components/        # مكونات قابلة لإعادة الاستخدام
│       │   ├── animations/    # مكونات الرسوم المتحركة
│       │   └── ui/            # مكونات shadcn/ui
│       ├── contexts/          # مزودو سياق React
│       ├── hooks/             # خطافات React المخصصة
│       ├── lib/               # وظائف الأدوات المساعدة
│       └── pages/             # مكونات الصفحة (واحد لكل مسار)
├── server/                    # تطبيق الواجهة الخلفية
│   ├── routes/                # تعريفات موجه tRPC
│   ├── db/                    # مخطط قاعدة البيانات والترحيلات
│   │   ├── schema.ts          # تعريفات مخطط Drizzle ORM
│   │   └── migrations/        # ملفات ترحيل SQL
│   └── middleware/            # المصادقة والتحقق من الصحة
├── shared/                    # الأنواع والأدوات المساعدة المشتركة
│   └── types/                 # تعريفات نوع TypeScript
├── package.json
├── vite.config.ts             # تكوين بناء Vite
├── tailwind.config.ts         # تكوين TailwindCSS
├── tsconfig.json              # تكوين TypeScript
└── drizzle.config.ts          # تكوين Drizzle ORM
```

## 3. معايير الترميز

### 3.1. TypeScript

- **الوضع الصارم** ممكّن. يجب أن يجتاز كل الكود فحص النوع الصارم لـ TypeScript.
- استخدم **أنواع الإرجاع الصريحة** لجميع الوظائف المصدرة.
- تفضيل **الواجهات** على الأسماء المستعارة للنوع لأشكال الكائنات.
- استخدم **التعدادات** باعتدال؛ تفضيل أنواع الاتحاد (على سبيل المثال، `'draft' | 'published' | 'archived'`).
- لا تستخدم أبدًا نوع `any`. استخدم `unknown` عندما يكون النوع غير معروف حقًا.

### 3.2. مكونات React

- استخدم **المكونات الوظيفية** مع الخطافات. لا يتم استخدام المكونات الطبقية في هذا المشروع.
- اتبع **مبدأ المسؤولية الواحدة**: يجب أن يقوم كل مكون بشيء واحد بشكل جيد.
- ضع مكونات الصفحة في `client/src/pages/` والمكونات القابلة لإعادة الاستخدام في `client/src/components/`.
- استخدم **PascalCase** لأسماء ملفات المكونات (على سبيل المثال، `BookmarkButton.tsx`).
- قم بتصدير المكونات **كتصديرات مسماة** (وليس تصديرات افتراضية).

### 3.3. التصميم

- استخدم **فئات أدوات TailwindCSS** لجميع التصميمات. تجنب ملفات CSS المخصصة.
- استخدم أداة `cn()` (من `clsx` + `tailwind-merge`) لأسماء الفئات الشرطية.
- اتبع نهج **RTL-first** الحالي: استخدم الخصائص المنطقية (`ms-`, `me-`, `ps-`, `pe-`) بدلاً من الخصائص الاتجاهية (`ml-`, `mr-`, `pl-`, `pr-`).
- استخدم **مكونات shadcn/ui** لعناصر واجهة المستخدم الشائعة. لا تنشئ تطبيقات مخصصة للأزرار والمدخلات والحوارات وما إلى ذلك.

### 3.4. تطوير واجهة برمجة التطبيقات

- حدد جميع إجراءات واجهة برمجة التطبيقات في **موجه tRPC** المناسب ضمن `server/routes/`.
- استخدم **مخططات Zod** للتحقق من صحة الإدخال على جميع الطفرات والاستعلامات ذات المعلمات.
- اتبع اصطلاح التسمية: `router.action` (على سبيل المثال، `news.create`, `approval.reviewNews`).
- افصل **الاستعلامات العامة** (`list`) عن **استعلامات المسؤول** (`all`).
- تحقق دائمًا من **أذونات المستخدم** في إجراءات الطفرة.

### 3.5. قاعدة البيانات

- حدد جميع تغييرات المخطط في `server/db/schema.ts` باستخدام **Drizzle ORM**.
- قم بإنشاء ترحيلات باستخدام `npx drizzle-kit generate` بعد تغييرات المخطط.
- لا تقم أبدًا بتعديل ملفات الترحيل بعد تثبيتها.
- قم بتضمين **الفهارس المناسبة** للأعمدة المستخدمة في عبارات WHERE وشروط JOIN.

### 3.6. اصطلاحات التسمية

| العنصر | الاصطلاح | مثال |
|:---|:---|:---|
| المكونات | PascalCase | `BookmarkButton` |
| الملفات (المكونات) | PascalCase.tsx | `BookmarkButton.tsx` |
| الملفات (الأدوات المساعدة) | camelCase.ts | `formatDate.ts` |
| الوظائف | camelCase | `handleSubmit` |
| المتغيرات | camelCase | `isLoading` |
| الثوابت | UPPER_SNAKE_CASE | `MAX_RETRY_ATTEMPTS` |
| موجهات tRPC | camelCase | `weeklyReport` |
| إجراءات tRPC | camelCase | `getById` |
| جداول قاعدة البيانات | snake_case | `weekly_report_settings` |
| أعمدة قاعدة البيانات | camelCase | `isPublished` |
| فئات CSS | kebab-case (Tailwind) | `bg-primary text-white` |

## 4. سير عمل التطوير

### 4.1. استراتيجية التفريع

يتبع المشروع نموذج Git Flow مبسطًا:

- `main` — كود جاهز للإنتاج. لا يسمح بالتثبيتات المباشرة.
- `develop` — فرع تكامل للميزات. يدمج مع `main` للإصدارات.
- `feature/{name}` — فروع الميزات التي تم إنشاؤها من `develop`.
- `fix/{name}` — فروع إصلاح الأخطاء التي تم إنشاؤها من `develop` أو `main` (للإصلاحات العاجلة).

### 4.2. إنشاء فرع ميزة

```bash
git checkout develop
git pull origin develop
git checkout -b feature/add-comment-reactions
```

### 4.3. إجراء التغييرات

1. اكتب الكود الخاص بك باتباع معايير الترميز أعلاه.
2. تأكد من نجاح تجميع TypeScript: `npx tsc --noEmit`.
3. اختبر تغييراتك محليًا عن طريق تشغيل خادم التطوير.
4. تحقق من أن الوظائف الحالية لم تتعطل.

### 4.4. تثبيت التغييرات

اتبع مواصفات **Conventional Commits**:

```
<type>(<scope>): <description>

[optional body]
[optional footer]
```

الأنواع: `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `chore`.

أمثلة:
```
feat(news): add comment reactions feature
fix(auth): resolve account lockout timing issue
docs(api): update API reference for new endpoints
refactor(components): extract shared media viewer logic
```

### 4.5. تقديم طلب سحب

1. ادفع فرعك إلى المستودع البعيد.
2. أنشئ طلب سحب يستهدف فرع `develop`.
3. املأ قالب طلب السحب بما يلي:
   - وصف التغييرات
   - لقطات شاشة (لتغييرات واجهة المستخدم)
   - خطوات الاختبار
   - المشكلات ذات الصلة
4. اطلب مراجعة من عضو واحد على الأقل في الفريق.
5. عالج ملاحظات المراجعة وقم بتحديث طلب السحب.
6. بمجرد الموافقة، سيتم دمج طلب السحب بواسطة مشرف.

## 5. إضافة ميزات جديدة

### 5.1. إضافة نوع محتوى جديد

لإضافة نوع محتوى جديد (على سبيل المثال، "البودكاست"):

1. **مخطط قاعدة البيانات:** أضف تعريف الجدول في `server/db/schema.ts`.
2. **موجه tRPC:** أنشئ `server/routes/podcasts.ts` مع إجراءات `list` و `all` و `create` و `update` و `delete`.
3. **تسجيل الموجه:** أضف الموجه الجديد إلى موجه تطبيق tRPC الرئيسي.
4. **مكونات الصفحة:** أنشئ `PodcastsPage.tsx` و `PodcastDetailPage.tsx` في `client/src/pages/`.
5. **التوجيه:** أضف المسارات في `App.tsx`.
6. **التنقل:** أضف عناصر القائمة في `Navbar.tsx`.
7. **لوحة التحكم:** قم بتحديث `DashboardPage.tsx` بعدد المحتوى الجديد.

### 5.2. إضافة مكون واجهة مستخدم جديد

1. تحقق مما إذا كان **shadcn/ui** يوفر المكون: `npx shadcn-ui add <component>`.
2. إذا كان مخصصًا، فأنشئ المكون في `client/src/components/`.
3. حدد **واجهة خصائص** واضحة باستخدام TypeScript.
4. استخدم **TailwindCSS** للتصميم مع `cn()` للفئات الشرطية.
5. تأكد من **توافق RTL** باستخدام الخصائص المنطقية.

## 6. استكشاف الأخطاء وإصلاحها

| المشكلة | الحل |
|:---|:---|
| خطأ في اتصال قاعدة البيانات | تحقق من `DATABASE_URL` في `.env` وتأكد من تشغيل MySQL |
| أخطاء تجميع TypeScript | قم بتشغيل `npx tsc --noEmit` وإصلاح المشكلات المبلغ عنها |
| عدم عمل Vite HMR | امسح ذاكرة التخزين المؤقت للمتصفح وأعد تشغيل خادم التطوير |
| أخطاء نوع tRPC | قم بتشغيل `npm run build` لإعادة إنشاء تعريفات النوع |
| عدم تطبيق فئات TailwindCSS | تأكد من تضمين مسار الملف في مصفوفة محتوى `tailwind.config.ts` |
