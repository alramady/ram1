# 8. الاختبار والنشر

## 8.1. استراتيجية الاختبار

تعتبر استراتيجية الاختبار لمنصة راصد الوطنية شاملة، حيث تشمل مستويات متعددة من الاختبار لضمان موثوقية واستقرار وأداء التطبيق. تم تصميم الاستراتيجية لتحديد المشكلات وحلها في وقت مبكر من دورة التطوير، مما يقلل من تكلفة وتعقيد إصلاح الأخطاء.

### 8.1.1. اختبار الوحدة

تركز اختبارات الوحدة على المكونات والوظائف الفردية. نظرًا لأن الواجهة الأمامية مبنية باستخدام React و TypeScript، فسيتم كتابة اختبارات الوحدة باستخدام إطار عمل مثل Jest أو Vitest مع React Testing Library. ستتحقق هذه الاختبارات من أن كل مكون يتم عرضه بشكل صحيح وأن منطقه الداخلي يعمل كما هو متوقع. تشمل المجالات الرئيسية لاختبار الوحدة ما يلي:

- **مكونات واجهة المستخدم:** اختبار مكونات واجهة المستخدم الفردية بمعزل للتحقق من عرضها وتغييرات الحالة ومعالجة الأحداث. على سبيل المثال، اختبار `BookmarkButton` للتأكد من أنه يبدل حالته بشكل صحيح عند النقر فوقه.
- **وظائف الأدوات المساعدة:** اختبار وظائف المساعدة والأدوات المساعدة للحصول على مخرجات صحيحة بالنظر إلى مدخلات مختلفة.
- **إدارة الحالة:** اختبار المنطق داخل خطافات وسياقات إدارة الحالة.

### 8.1.2. اختبار التكامل

تركز اختبارات التكامل على التفاعلات بين الأجزاء المختلفة من التطبيق. يتضمن ذلك اختبار الاتصالات بين مكونات الواجهة الأمامية وطبقة واجهة برمجة تطبيقات tRPC وقاعدة البيانات. بالنسبة لمنصة راصد، سيشمل ذلك:

- **تفاعلات المكونات:** اختبار كيفية تفاعل المكونات الأصل والفرعية، على سبيل المثال، كيفية تحديث مكون النموذج لحالة الصفحة الأصل.
- **نقاط نهاية واجهة برمجة التطبيقات:** كتابة اختبارات لكل إجراء tRPC للتأكد من أنها تتعامل مع الطلبات والاستجابات بشكل صحيح، وأنها تتفاعل مع قاعدة البيانات كما هو متوقع. سيغطي هذا جميع عمليات CRUD للأخبار ومقاطع الفيديو والمستخدمين وما إلى ذلك.
- **المصادقة والترخيص:** اختبار تدفق تسجيل الدخول وإعادة تعيين كلمة المرور والتحكم في الوصول المستند إلى الأدوار للتأكد من أن المستخدمين يمكنهم فقط الوصول إلى الموارد المسموح لهم بها.

### 8.1.3. اختبار من طرف إلى طرف (E2E)

تحاكي اختبارات E2E سيناريوهات المستخدم الحقيقية من البداية إلى النهاية. سيتم إجراء هذه الاختبارات باستخدام إطار عمل مثل Cypress أو Playwright. ستغطي اختبارات E2E رحلات المستخدم الهامة، مثل:

- **تسجيل المستخدم وتسجيل الدخول:** يقوم المستخدم بإنشاء حساب وتسجيل الدخول وإعادة توجيهه إلى لوحة التحكم الخاصة به.
- **إنشاء المحتوى والموافقة عليه:** يقوم محرر بإنشاء مقال إخباري، ويوافق عليه مشرف، ويظهر المقال على الموقع العام.
- **البحث والتصفية:** يبحث المستخدم عن محتوى ويطبق عوامل تصفية لتحسين النتائج.


## 8.2. خط أنابيب النشر

عملية النشر مؤتمتة لضمان الاتساق وتقليل مخاطر الخطأ البشري. تتم إدارة خط الأنابيب من خلال منصة Manus، التي توفر سير عمل مبسطًا من تثبيت الكود إلى نشر الإنتاج.

### 8.2.1. التكامل المستمر (CI)

عند كل دفعة إلى الفرع الرئيسي لمستودع Git، يتم تشغيل خط أنابيب CI. تتضمن عملية CI ما يلي:

- **فحص الأنماط والتحقق من نمط الكود:** فرض نمط كود متسق عبر المشروع.
- **تشغيل الاختبارات:** تنفيذ جميع اختبارات الوحدة والتكامل للتأكد من أن التغييرات الجديدة لم تقدم أي تراجعات.
- **بناء التطبيق:** تقوم أداة بناء Vite بتجميع الواجهة الأمامية React/TypeScript في أصول ثابتة محسّنة.

### 8.2.2. النشر المستمر (CD)

بمجرد اكتمال مرحلة CI بنجاح، يتولى خط أنابيب CD المسؤولية. عملية النشر هي كما يلي:

- **النشر إلى بيئة التدريج:** يتم نشر البنية الجديدة أولاً في بيئة تدريج تعكس إعداد الإنتاج. يسمح هذا بجولة أخيرة من الاختبار اليدوي والتحقق في بيئة آمنة.
- **نشر الإنتاج:** بعد التحقق الناجح في بيئة التدريج، يتم ترقية البنية إلى بيئة الإنتاج. تتعامل منصة Manus مع عملية تحديث التطبيق دون أي توقف.
