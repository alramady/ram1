# سجل الفئات والوظائف

يقدم هذا المستند قائمة شاملة بجميع مكونات React (التي تعمل بمثابة بنيات شبيهة بالفئات في قاعدة الكود الوظيفية هذه) ووظائفها الرئيسية، والخطافات (hooks)، وأنماط إدارة الحالة. نظرًا لأن منصة راصد الوطنية مبنية بالكامل باستخدام مكونات React الوظيفية والخطافات، يتم تنظيم هذا السجل حسب المكون بدلاً من التسلسل الهرمي التقليدي للفئات.

## 1. مكونات الصفحة

### 1.1. الصفحة الرئيسية (`client/src/pages/Home.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | صفحة الهبوط الرئيسية التي تعرض المحتوى المميز وآخر الأخبار وأبرز ميزات المنصة |
| **الحالة** | حالة الخادم عبر React Query: `news.latest`, `videos.list`, `presentations.list` |
| **الوظائف الرئيسية** | عرض المحتوى، عدادات متحركة للإحصائيات، تأثيرات خلفية بالجزيئات |
| **الاعتماديات** | `AnimatedCounter`, `FloatingParticles`, `SectionHeader`, `PageTransition` |

### 1.2. صفحة تسجيل الدخول (`client/src/pages/LoginPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | مصادقة المستخدم باستخدام اسم المستخدم/كلمة المرور |
| **الحالة** | حالة محلية: `username`, `password`, `error`, `passwordStrength` |
| **الوظائف الرئيسية** | `handleSubmit` — تتحقق من صحة المدخلات، وتستدعي تعديل `auth.localLogin`؛ `calculatePasswordStrength` — تقييم قوة كلمة المرور في الوقت الفعلي (5 مستويات) |
| **التعديلات** | `auth.localLogin` — يصادق على المستخدم ويضبط ملف تعريف ارتباط JWT |
| **معالجة الأخطاء** | يعرض رسائل الخطأ من الخادم؛ يتعامل مع إشعارات قفل الحساب |

### 1.3. صفحة لوحة التحكم (`client/src/pages/DashboardPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | لوحة تحكم المسؤول مع إحصائيات المحتوى والإجراءات السريعة |
| **الحالة** | حالة الخادم: استعلام `dashboard.stats` |
| **الوظائف الرئيسية** | يعرض بطاقات الإحصائيات للأخبار ومقاطع الفيديو والصور والأدلة والعروض التقديمية وسجل الزوار والمستخدمين والروابط وملفات الأعضاء |
| **التحكم في الوصول** | يتطلب دور المسؤول |

### 1.4. صفحة الأخبار (`client/src/pages/NewsPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | صفحة قائمة الأخبار مع التصفية والبحث |
| **الحالة** | حالة الخادم: `news.list` (عام) أو `news.all` (مسؤول)؛ حالة محلية: تصفية، بحث، ترقيم الصفحات |
| **الوظائف الرئيسية** | تصفية المحتوى حسب الفئة، وظيفة البحث، ترقيم الصفحات |
| **الاعتماديات** | `SectionHeader`, `BookmarkButton`, `LikeButton`, `PageTransition` |

### 1.5. صفحة تفاصيل الخبر (`client/src/pages/NewsDetailPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | عرض المقال الكامل مع عرض محتوى غني |
| **الحالة** | حالة الخادم: `news.getById`; `bookmarks.isBookmarked` |
| **الوظائف الرئيسية** | عرض محتوى HTML، المشاركة الاجتماعية، تبديل الإشارات المرجعية، عرض التعليقات |
| **الاعتماديات** | `ScrollProgressBar`, `CommentsSection`, `BookmarkButton`, `LikeButton`, `MediaViewer` |

### 1.6. صفحة التحليلات (`client/src/pages/AnalyticsPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | لوحة تحكم تحليلية شاملة مع مخططات ومقاييس |
| **الحالة** | حالة الخادم: `analytics.overview`, `analytics.activityByDay`, `analytics.contentByMonth`, `analytics.userRegistrations`, `analytics.topLiked`, `analytics.recentActivity` |
| **الوظائف الرئيسية** | عرض المخططات عبر Recharts، إنشاء التقارير، تجميع البيانات |
| **الاعتماديات** | `PdfReportButton`, مكونات Recharts |
| **التحكم في الوصول** | يتطلب دور المسؤول |

### 1.7. صفحة الموافقة (`client/src/pages/ApprovalPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | إدارة سير عمل الموافقة على المحتوى |
| **الحالة** | حالة الخادم: `approval.pendingNews`, `approval.pendingVideos`, `approval.mySubmissions` |
| **الوظائف الرئيسية** | `handleApprove` — يستدعي `approval.reviewNews`/`approval.reviewVideo` بحالة الموافقة؛ `handleReject` — يستدعي بحالة الرفض وملاحظة المراجعة |
| **التعديلات** | `approval.reviewNews`, `approval.reviewVideo` |
| **التحكم في الوصول** | يتطلب دور مشرف المحتوى أو المسؤول |

### 1.8. صفحة الرسائل (`client/src/pages/MessagesPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | نظام مراسلة داخلي مع صندوق وارد ومرسل وعروض إنشاء |
| **الحالة** | حالة الخادم: `messages.inbox`, `messages.sent`, `messages.unreadCount`, `messages.users` |
| **الوظائف الرئيسية** | `handleSend` — يرسل رسالة عبر تعديل `messages.send`؛ `handleBroadcast` — يرسل إلى جميع المستخدمين عبر `messages.broadcast`؛ `handleMarkRead`/`handleMarkUnread` — يبدل حالة القراءة |
| **التعديلات** | `messages.send`, `messages.broadcast`, `messages.delete`, `messages.markRead`, `messages.markUnread` |

### 1.9. صفحة الجدولة (`client/src/pages/SchedulingPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | إدارة جدولة المحتوى والنشر |
| **الحالة** | حالة الخادم: `scheduling.allNewsWithStatus`, `scheduling.allVideosWithStatus`, `scheduling.scheduledNews`, `scheduling.scheduledVideos` |
| **الوظائف الرئيسية** | `handlePublishNow` — ينشر المحتوى فورًا؛ `handleUpdateStatus` — يغير حالة النشر؛ `handleSchedule` — يضبط تاريخ النشر المستقبلي |
| **التعديلات** | `scheduling.updateNewsStatus`, `scheduling.updateVideoStatus`, `scheduling.publishNow` |

### 1.10. صفحة لوحة التحكم حسب الدور (`client/src/pages/RoleDashboardPage.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | لوحة تحكم ديناميكية تعرض محتوى مختلفًا بناءً على دور المستخدم |
| **الحالة** | حالة الخادم: `auth.me` للكشف عن الدور |
| **الوظائف الرئيسية** | اختيار المكونات حسب الدور: `admin` ← لوحة تحكم كاملة؛ `content_moderator` ← قائمة انتظار الموافقة؛ `editor` ← إنشاء المحتوى؛ `viewer` ← محتوى للقراءة فقط |
| **تعيين الأدوار** | `{ admin: AdminDashboard, content_moderator: ModeratorDashboard, editor: EditorDashboard, viewer: ViewerDashboard, user: UserDashboard }` |

## 2. المكونات القابلة لإعادة الاستخدام

### 2.1. التخطيط (`client/src/components/Layout.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | غلاف تخطيط التطبيق الرئيسي الذي يوفر بنية متسقة |
| **الخصائص** | `children: ReactNode` |
| **البنية** | `Navbar` ← `main content` ← `Footer` |
| **الميزات** | تخطيط متجاوب، دعم RTL، تصميم يراعي السمة |

### 2.2. شريط التنقل (`client/src/components/Navbar.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | شريط التنقل الأساسي مع قائمة متجاوبة |
| **الحالة** | حالة الخادم: `auth.me` لمعلومات المستخدم؛ حالة محلية: `isMenuOpen`, `isScrolled` |
| **الوظائف الرئيسية** | تغييرات النمط المستندة إلى التمرير، قائمة همبرغر متجاوبة، عناصر تنقل حسب الدور |
| **الاعتماديات** | `NotificationBell`, `ThemeContext` |

### 2.3. محرر النصوص المنسقة (`client/src/components/RichTextEditor.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | محرر نصوص منسقة كامل الميزات لإنشاء المحتوى |
| **الخصائص** | `content: string`, `onChange: (html: string) => void`, `placeholder?: string` |
| **الحالة** | مثيل محرر Tiptap |
| **الميزات** | غامق، مائل، عناوين، قوائم، روابط، صور، كتل كود، اقتباسات |
| **الاعتماديات** | `@tiptap/react`, `@tiptap/starter-kit` |

### 2.4. زر الإشارة المرجعية (`client/src/components/BookmarkButton.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | زر تبديل لوضع إشارة مرجعية على عناصر المحتوى |
| **الخصائص** | `contentType: string`, `contentId: number` |
| **الحالة** | حالة الخادم: `bookmarks.isBookmarked` |
| **التعديلات** | `bookmarks.toggle` — يضيف أو يزيل الإشارة المرجعية |
| **السلوك** | تحديث متفائل لواجهة المستخدم مع تسوية الخادم |

### 2.5. قسم التعليقات (`client/src/components/CommentsSection.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | يعرض ويدير التعليقات على عناصر المحتوى |
| **الخصائص** | `contentType: string`, `contentId: number` |
| **الحالة** | حالة محلية: `newComment`؛ حالة الخادم: قائمة التعليقات |
| **الوظائف الرئيسية** | `handleSubmitComment` — ينشر تعليقًا جديدًا؛ `handleDeleteComment` — يزيل التعليق |

### 2.6. جرس الإشعارات (`client/src/components/NotificationBell.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | مؤشر إشعارات مع شارة عدد غير مقروء |
| **الحالة** | حالة الخادم: `notifications.unreadCount` (يتم استقصاؤه) |
| **الوظائف الرئيسية** | استقصاء عدد غير مقروء، قائمة إشعارات منسدلة، وضع علامة كمقروء |
| **الاعتماديات** | `notifications.list`, `notifications.markRead`, `notifications.markAllRead` |

### 2.7. زر تقرير PDF (`client/src/components/PdfReportButton.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | ينشئ ويحمل تقارير PDF من بيانات التحليلات |
| **الخصائص** | `data: AnalyticsData`, `title?: string` |
| **الوظائف الرئيسية** | `handleGenerateReport` — يجمع البيانات في تنسيق PDF ويطلق التنزيل |

### 2.8. عارض الوسائط (`client/src/components/MediaViewer.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | عارض مشروط للصور ومقاطع الفيديو مع تكبير وتنقل |
| **الخصائص** | `media: MediaItem`, `isOpen: boolean`, `onClose: () => void` |
| **الميزات** | وضع ملء الشاشة، ضوابط التكبير، التنقل بلوحة المفاتيح، خيار التنزيل |

### 2.9. وضع العرض التقديمي (`client/src/components/PresentationMode.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | عارض عرض تقديمي بملء الشاشة مع تنقل بين الشرائح |
| **الخصائص** | `slides: Slide[]`, `currentSlide: number` |
| **الوظائف الرئيسية** | التنقل بلوحة المفاتيح (مفاتيح الأسهم)، تبديل ملء الشاشة، عداد الشرائح |
| **الاعتماديات** | `PresentationToolbar` |

## 3. مكونات الرسوم المتحركة

### 3.1. خلفية الجسيمات (`client/src/components/animations/ParticleBackground.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | رسوم متحركة للجسيمات قائمة على Canvas للخلفيات المرئية |
| **الخصائص** | `particleCount?: number`, `color?: string`, `speed?: number` |
| **التنفيذ** | HTML5 Canvas مع حلقة requestAnimationFrame |

### 3.2. الكشف عند التمرير (`client/src/components/animations/ScrollReveal.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | يكشف عن العناصر الفرعية مع رسوم متحركة أثناء تمريرها إلى العرض |
| **الخصائص** | `children: ReactNode`, `direction?: 'up' | 'down' | 'left' | 'right'` |
| **التنفيذ** | Intersection Observer API + Framer Motion |

### 3.3. النص الحركي (`client/src/components/animations/KineticText.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | تأثيرات نصية متحركة للعناوين وأقسام البطل |
| **الخصائص** | `text: string`, `animation?: 'typewriter' | 'wave' | 'bounce'` |
| **التنفيذ** | رسوم متحركة حرف بحرف من Framer Motion |

## 4. مزودو السياق

### 4.1. سياق السمة (`client/src/contexts/ThemeContext.tsx`)

| الخاصية | الوصف |
|:---|:---|
| **الغرض** | يدير حالة السمة الداكنة/الفاتحة عبر التطبيق |
| **القيم المقدمة** | `theme: 'dark' | 'light'`, `toggleTheme: () => void` |
| **الاستمرارية** | يتم تخزين تفضيل السمة في `localStorage` |
| **التنفيذ** | يبدل فئة `dark` على `document.documentElement` لوضع TailwindCSS الداكن |

## 5. أنماط خطاف tRPC

تتبع جميع عمليات جلب البيانات في التطبيق نمطًا ثابتًا باستخدام تكامل React Query الخاص بـ tRPC.

**نمط الاستعلام:**
```typescript
const { data, isLoading, error } = trpc.{router}.{procedure}.useQuery(input);
```

**نمط التعديل:**
```typescript
const mutation = trpc.{router}.{procedure}.useMutation({
  onSuccess: () => {
    utils.{router}.{relatedQuery}.invalidate();
    toast.success("Operation successful");
  },
  onError: (error) => {
    toast.error(error.message || "Operation failed");
  }
});
```

يضمن هذا النمط معالجة متسقة للأخطاء، وإبطال صلاحية ذاكرة التخزين المؤقت، وملاحظات المستخدم عبر جميع عمليات البيانات في التطبيق.
